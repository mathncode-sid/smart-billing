<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Utility Billing Assistant - Pay Bills</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">Smart Billing</a>
                
                <nav class="nav" role="navigation" aria-label="Main navigation">
                    <a href="index.html" class="nav-link">Dashboard</a>
                    <a href="pay.html" class="nav-link">Pay</a>
                    <a href="split.html" class="nav-link">Split</a>
                    <a href="history.html" class="nav-link">History</a>
                    <a href="settings.html" class="nav-link">Settings</a>
                    <a href="ussd.html" class="nav-link">USSD Simulator</a>
                </nav>
                
                <button class="theme-toggle" aria-label="Toggle dark mode">ðŸŒ™</button>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <section aria-labelledby="payment-title">
                <h1 id="payment-title" class="mb-6">Pay Bills & Top-Up</h1>
                
                <div class="grid grid-2">
                    <!-- Payment Form -->
                    <div class="card">
                        <h2 class="card-title mb-4">Make Payment</h2>
                        
                        <form id="payment-form" novalidate>
                            <div class="form-group">
                                <label for="utility-select" class="form-label">Select Utility *</label>
                                <select id="utility-select" class="form-select" required aria-describedby="utility-help">
                                    <option value="">Choose a utility to pay</option>
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                                <small id="utility-help" class="text-secondary">Select the utility you want to pay</small>
                            </div>

                            <div class="form-group">
                                <label for="amount" class="form-label">Amount (KES) *</label>
                                <input 
                                    type="number" 
                                    id="amount" 
                                    class="form-input" 
                                    placeholder="Enter amount to pay"
                                    min="1"
                                    step="0.01"
                                    required
                                    aria-describedby="amount-help"
                                >
                                <small id="amount-help" class="text-secondary">Enter the amount you want to pay</small>
                            </div>

                            <fieldset class="form-group">
                                <legend class="form-label">Payment Method *</legend>
                                <div class="radio-group" role="radiogroup" aria-required="true">
                                    <div class="radio-item">
                                        <input type="radio" id="mpesa" name="payment-method" value="M-Pesa" required>
                                        <label for="mpesa">M-Pesa</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="airtel" name="payment-method" value="Airtel" required>
                                        <label for="airtel">Airtel Money</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="tkash" name="payment-method" value="T-Kash" required>
                                        <label for="tkash">T-Kash</label>
                                    </div>
                                    <div class="radio-item">
                                        <input type="radio" id="airtime" name="payment-method" value="Airtime" required>
                                        <label for="airtime">Airtime</label>
                                    </div>
                                </div>
                            </fieldset>

                            <button type="submit" class="btn btn-primary">
                                Confirm Payment
                            </button>
                        </form>
                    </div>

                    <!-- Payment Summary & Tips -->
                    <div>
                        <div class="card mb-4">
                            <h3 class="card-title">Payment Summary</h3>
                            <div id="payment-summary">
                                <p class="text-secondary">Select a utility to see payment details</p>
                            </div>
                        </div>

                        <div class="card">
                            <h3 class="card-title">Payment Tips</h3>
                            <ul class="text-secondary" style="padding-left: 1.5rem; line-height: 1.8;">
                                <li>Ensure you have sufficient balance in your mobile money account</li>
                                <li>Keep your transaction reference for future reference</li>
                                <li>Payments are processed instantly and updated in your history</li>
                                <li>You can pay partial amounts to manage your cash flow</li>
                                <li>Set up reminders in Settings to never miss a due date</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Recent Payments -->
                <section aria-labelledby="recent-payments-title" class="mt-6">
                    <h2 id="recent-payments-title" class="mb-4">Recent Payments</h2>
                    <div id="recent-payments" class="card">
                        <!-- Recent payments will be populated by JavaScript -->
                    </div>
                </section>
            </section>
        </div>
    </main>

    <script src="app.js"></script>
    <script>
        // Payment page specific functionality
        document.addEventListener('DOMContentLoaded', function() {
            setupPaymentSummary();
            displayRecentPayments();
        });

        function setupPaymentSummary() {
            const utilitySelect = document.getElementById('utility-select');
            const amountInput = document.getElementById('amount');
            const paymentSummary = document.getElementById('payment-summary');

            function updateSummary() {
                const selectedUtilityId = utilitySelect.value;
                const amount = parseFloat(amountInput.value) || 0;

                if (!selectedUtilityId || !window.app) {
                    paymentSummary.innerHTML = '<p class="text-secondary">Select a utility to see payment details</p>';
                    return;
                }

                const utility = window.app.data.utilities.find(u => u.id === selectedUtilityId);
                if (!utility) return;

                const remainingBalance = Math.max(0, utility.balance - amount);
                const progressAfterPayment = Math.min(100, ((utility.instalmentPaid + amount) / utility.monthlyAmount) * 100);

                paymentSummary.innerHTML = `
                    <div class="mb-4">
                        <h4 class="font-semibold">${utility.name}</h4>
                        <p class="text-secondary">${utility.provider}</p>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>Current Balance:</span>
                            <span class="font-semibold">KES ${utility.balance.toLocaleString()}</span>
                        </div>
                        ${amount > 0 ? `
                        <div class="flex justify-between">
                            <span>Payment Amount:</span>
                            <span class="font-semibold text-primary">KES ${amount.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Remaining Balance:</span>
                            <span class="font-semibold ${remainingBalance === 0 ? 'text-success' : ''}">KES ${remainingBalance.toLocaleString()}</span>
                        </div>
                        <div class="mt-3">
                            <div class="flex justify-between items-center mb-2">
                                <span>Progress After Payment:</span>
                                <span class="font-semibold">${Math.round(progressAfterPayment)}%</span>
                            </div>
                            <div class="progress ${progressAfterPayment === 100 ? 'progress-success' : ''}">
                                <div class="progress-bar" style="width: ${progressAfterPayment}%"></div>
                            </div>
                        </div>
                        ` : ''}
                        <div class="flex justify-between text-sm text-secondary">
                            <span>Due Date:</span>
                            <span>${new Date(utility.dueDate).toLocaleDateString()}</span>
                        </div>
                    </div>
                `;
            }

            utilitySelect.addEventListener('change', updateSummary);
            amountInput.addEventListener('input', updateSummary);
        }

        function displayRecentPayments() {
            if (!window.app || !window.app.data) return;

            const recentPayments = window.app.data.transactions.slice(0, 5);
            const container = document.getElementById('recent-payments');

            if (recentPayments.length === 0) {
                container.innerHTML = '<p class="text-center text-secondary">No recent payments found</p>';
                return;
            }

            container.innerHTML = `
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Utility</th>
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${recentPayments.map(payment => `
                                <tr>
                                    <td>${new Date(payment.date).toLocaleDateString()}</td>
                                    <td>${payment.utility}</td>
                                    <td>KES ${payment.amount.toLocaleString()}</td>
                                    <td>${payment.method}</td>
                                    <td>
                                        <span class="badge ${payment.status === 'Completed' ? 'badge-success' : 'badge-warning'}">
                                            ${payment.status}
                                        </span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
    </script>
</body>
</html>
